<!DOCTYPE html>
<html>
  <head>
  <link rel='shortcut icon' href='Images/nature.ico' type='image/x-icon'/ >
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<style>
	.svg2 {
	margin-left:50px;
	margin-top:50px;
	}
	</style>
  </head>
  <body>
  
  <script>
  var width2=600;
  var height2=400;
  var color2=["#ddd","#bbbbbb","#999999","#666666","#4d4d4d","#8382BD"];
  var stackheight=height2/6;
  var svg2=d3.select("body").append("svg").attr("class","svg2").attr("width",width2).attr("height",height2);
  var jsondata;
  
  
  d3.json("data.json", function(json) {
  jsondata=json;
  });
  
  svg2.append("rect")
	.attr("width",width2)
	.attr("height",stackheight)
	.attr("y",0)
	.style("fill",function() {
	return color2[0];
	})
	.attr("stroke-width",1)
	.attr("stroke","#ccc")
	.on("mouseover",function(){
	/*tooltip here - use jsondata */
	});
	
	
 function createrect(widthc,levelc,positionc,ifchildc) {
 
 svg2.append("rect")
	.attr("class","stacks")
	.attr("width",widthc)
	.attr("height",stackheight)
	.attr("x",positionc)
	.attr("y",stackheight*(levelc+1))
	.style("fill",function() {
	if(ifchildc==true)
	return color2[levelc+1];
	else
	return "#8382BD";
	})
	.attr("stroke-width",1)
	.attr("stroke","#ccc");
	
 }
 
 var lvltotal=[0,0,0,0,0];
  d3.json("data.json", function(json) {
  var leafwidth=width2/Number(json.leafs);
  console.log(json);
  var lvl=[0,0,0,0,0];
for(var j=0;j<json.children.length;j++){
lvl[0]=lvl[0]+1;
lvltotal[0]=lvltotal[0]+json.children[j].leafs;
for(var k=0;k<json.children[j].children.length;k++){
lvl[1]=lvl[1]+1;
lvltotal[1]=lvltotal[1]+json.children[j].children[k].leafs;
for(var l=0;l<json.children[j].children[k].children.length;l++){
lvl[2]=lvl[2]+1;
lvltotal[2]=lvltotal[2]+json.children[j].children[k].children[l].leafs;
for(var m=0;m<json.children[j].children[k].children[l].children.length;m++){
lvl[3]=lvl[3]+1;
lvltotal[3]=lvltotal[3]+json.children[j].children[k].children[l].children[m].leafs;
if(json.children[j].children[k].children[l].children[m].children){
for(var n=0;n<json.children[j].children[k].children[l].children[m].children.length;n++){
lvl[4]=lvl[4]+1;
lvltotal[4]=lvltotal[4]+json.children[j].children[k].children[l].children[m].children[n].leafs;
}
}
}
}
}
}

  console.log(lvl[0]+"-"+lvl[1]+"-"+lvl[2]+"-"+lvl[3]+"-"+lvl[4]);
  
  if(json.children) {
  json.xpos=0;
  json.width=width2;
  var lvl0position=0;
  for(var j=0;j<lvl[0];j++){
  var lvl0width=Number(json.children[j].leafs/lvltotal[j]*width2);
  var lvl0level=0;
  if(j!=0)
  var lvl0position=Number(lvl0position+((Number(json.children[j-1].leafs)/lvltotal[j-1])*width2));
  var ifchild=json.children[j].children ? true : false;
  json.children[j].xpos=lvl0position;
  json.children[j].width=lvl0width;
  createrect(lvl0width,lvl0level,lvl0position,ifchild);
  
	if(json.children[j].children) {
	var sum=0;
    for(var k=0;k<json.children[j].children.length;k++) {
	sum=sum+Number(json.children[j].children[k].leafs);
	}
	
	var lvl1position=Number(json.children[j].xpos);
	for(var k=0;k<json.children[j].children.length;k++){
	var lvl1width=Number((Number(json.children[j].children[k].leafs)/sum)*Number(json.children[j].width));
	json.children[j].children[k].width=lvl1width;
	var lvl1level=1;
	if(k!=0)
	var lvl1position=Number((Number(json.children[j].children[k-1].width)+Number(json.children[j].children[k-1].xpos)));
	json.children[j].children[k].xpos=lvl1position;
	var ifchild=json.children[j].children[k].children ? true : false;
	createrect(lvl1width,lvl1level,lvl1position,ifchild);
	
	if(json.children[j].children[k].children) {
	var sum1=0;
    for(var l=0;l<json.children[j].children[k].children.length;l++) {
	sum1=sum1+Number(json.children[j].children[k].children[l].leafs);
	}
	
	var lvl2position=Number(json.children[j].children[k].xpos);
	for(var l=0;l<json.children[j].children[k].children.length;l++){
	var lvl2width=Number((Number(json.children[j].children[k].children[l].leafs)/sum1)*Number(json.children[j].children[k].width));
	json.children[j].children[k].children[l].width=lvl2width;
	var lvl2level=2;
	if(l!=0)
	var lvl2position=Number(Number(json.children[j].children[k].children[l-1].width)+Number(json.children[j].children[k].children[l-1].xpos));
	json.children[j].children[k].children[l].xpos=lvl2position;
	var ifchild=json.children[j].children[k].children[l].children ? true : false;
	createrect(lvl2width,lvl2level,lvl2position,ifchild);
	
	if(json.children[j].children[k].children[l].children) {
	var sum2=0;
    for(var m=0;m<json.children[j].children[k].children[l].children.length;m++) {
	sum2=sum2+Number(json.children[j].children[k].children[l].children[m].leafs);
	}
	
	var lvl3position=Number(json.children[j].children[k].children[l].xpos);
	for(var m=0;m<json.children[j].children[k].children[l].children.length;m++){
	if(json.children[j].children[k].children[l].children[m].leafs)
	var lvl3width=Number(Number(json.children[j].children[k].children[l].children[m].leafs)/sum2*Number(json.children[j].children[k].children[l].width));
	else
	var lvl3width=leafwidth;
	json.children[j].children[k].children[l].children[m].width=lvl3width;
	var lvl3level=3;
	if(m!=0)
	var lvl3position=Number(Number(json.children[j].children[k].children[l].children[m-1].width)+Number(json.children[j].children[k].children[l].children[m-1].xpos));
	json.children[j].children[k].children[l].children[m].xpos=lvl3position;
	var ifchild=json.children[j].children[k].children[l].children[m].children ? true : false;
	createrect(lvl3width,lvl3level,lvl3position,ifchild);
	
	
	
    if(json.children[j].children[k].children[l].children[m].children){
	var lvl4position=Number(json.children[j].children[k].children[l].children[m].xpos);
	for(var p=0;p<json.children[j].children[k].children[l].children[m].children.length;p++) {
	var lvl4width=leafwidth;
	json.children[j].children[k].children[l].children[m].children[p].width=lvl4width;
	var lvl4level=4;
	if(p!=0)
	var lvl4position=Number(Number(json.children[j].children[k].children[l].children[m].children[p-1].xpos)+Number(json.children[j].children[k].children[l].children[m].children[p-1].width));
	json.children[j].children[k].children[l].children[m].children[p].xpos=lvl4position;
	var ifchild=json.children[j].children[k].children[l].children[m].children[p].children ? true : false;
	createrect(lvl4width,lvl4level,lvl4position,ifchild);
	}
	}
	
	
	}
	}
	}
	}
	}
	}
  }
  }
});


  </script>
  
  </body>
</html>
