<!DOCTYPE html>
<html>
  <head>
  <link rel='shortcut icon' href='Images/nature.ico' type='image/x-icon'/ >
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="d3.geo.projection.min.js"></script>
	<style>
	.svg2 {
	margin-left:50px;
	margin-top:50px;
//	cursor: url('Images/nature.ico'), auto;
	}
	
	div.tooltip2 {
    position: absolute;     
    text-align: center;      
    font: 12px segoe ui;    
	background:#444;
    border: 1px solid #444;
	box-shadow: 0 0 5px #444;    
    pointer-events: none;     
	font-weight:bold;
	color:#eee;
	z-index:10;
}
	
	.picture {
	border:1px solid #aaa;
	}
	
	.stacks {
	
	}
	
	#image {
	position:absolute;
	}
	
	.svg3 {
		position:absolute;
		top:58px;
		left:670px;
		margin: 0 auto;
		display: inherit;
		border:1px solid #000;
	}

.graticule {
  fill: none;
  stroke: #777;
  stroke-width: 2px;
  stroke-opacity: .0;
}

.land {
  fill: #999;
}

.boundary {
  fill: none;
  stroke: #fff;
  stroke-width: .5px;
}

	.node circle {
	  stroke: #fff;
	  stroke-width: 1.5px;
	}
	
	.link {
    stroke: #ccc;
	stroke-width: 1.5px;
    }
	 
	.node text {
    pointer-events: none;
    font: 10px sans-serif;
	}

	.states path {
		stroke-width: 1px;
		stroke: white;
		fill: #DBDBDB;
		cursor: pointer;
	}

	.arcs path {
	  stroke-width: 2px;
	  stroke: tomato;
	  pointer-events: none;
	  fill: none;
	}
	
	.stackdesc, .mapdesc {
	position:absolute;
	top:400px;
	width:600px;
	height:200px;
	border:1px solid #000;
	}
	
	.stackdesc {
	left:50px;
	z-index:5;
	}
	
	.mapdesc {
	left:670px;
	}
	
	.consspan, .prodspan {
	border:1px solid #000;
	height:40px;
	padding:5px 5px 5px 5px;
	font-size:16px;
	letter-spacing:1px;
	font-family:segoe ui;
	}
	
	.consspan {
	background:yellow;
	}
	
	.prodspan {
	background:red;
	}
	
	.titledesc {
	padding-top:10px;
	padding-left:10px;
	border:1px solid #000;
	height:30px;
	}
	
	.imgdesc {
	border:1px solid red;
	width:120px;
	float:left;
	}
	
	.otherdesc {
	border:1px solid green;
	width:470px;
	float:right;
	height:150px;
	}
	
	.descdesc {
	border:1px solid pink;
	height:50px;
	width:450px;
	}
	
	.linkdesc {
	width:150px;
	height:50px;
	width:450px;
	padding:10px;
	border:1px solid blue;
	}
	
	.anchor {
	border:1px solid tomato;
	position:relative;
	left:170px;
	top:10px;
	}
	
	</style>
  </head>
  <body>
<!--  <img id="image" src="Images/nature.ico"/> -->
  <script>
 /* 
  $(document).mousemove(function(e){
    $("#image").css({left:e.pageX+20, top:e.pageY+20});
});
  */
  var width2=600;
  var height2=340;
  var width3=600;
  var height3=340;
  var color2=["#CFDBC5","#C0D9AF","#BCED91","#A6D785","#8FA880","#61B329"];
  var stackheight=height2/6;
  var svg2=d3.select("body").append("svg").attr("class","svg2").attr("width",width2).attr("height",height2);
  var svg3=d3.select("body").append("svg").attr("class","svg3").attr("width",width3).attr("height",height3);
  var projection = d3.geo.patterson().scale(100).translate([width3 / 2, height3 / 2]).precision(.1);
  var path = d3.geo.path().projection(projection);
  var graticule = d3.geo.graticule();
  var arcs = svg3.append("g").attr("class","arcs");
  var div2 = d3.select("body").append("div").attr("class", "tooltip2").style("opacity", 0);
  var jsondata;
  var foodchain=[];
  var childarr=[];
  var allstatus=0;
  var presentstatus=0;
  var previousid;
  var previouslvl;
  var centered;
  
  svg3.append("path")
    .datum(graticule)
    .attr("class", "graticule")
    .attr("d", path);
	
	d3.json("World_Map.json", function(error, world) {
  if (error) throw error; 
    var arcdata = [       
        {
			sourceLocation: [10.4515, 51.1657],
			targetLocation: [105.3188, 61.5240]
		}
	]

	
	 var places = [
  {
    name: "Germany",
    location: {
      latitude: 51.1657
,
      longitude: 10.4515

    }
  }]
       
     
  svg3.insert("path", ".graticule")
      .datum(topojson.feature(world, world.objects.land))
      .attr("class", "land")
      .attr("d", path);

  svg3.insert("path", ".graticule")
      .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))
      .attr("class", "boundary")
      .attr("d", path);
    
           
       
});
	
	d3.select(self.frameElement).style("height", height3 + "px");
	
	
	
	
	
	
	

  svg2.append("rect")
	.attr("width",width2)
	.attr("id","life")
	.attr("height",stackheight)
	.attr("y",0)
	.style("fill",function() {
	return color2[0];
	})
	.attr("stroke-width",1)
	.attr("stroke","#777")
	.on("mouseover",function(){
	/*tooltip here - use jsondata */
	})
	.on("click", function(){
	
	if(previousid!=null) {
	svg2.select(previousid)
	.style("fill", function() {
	return color2[previouslvl+1];
	});
	}
	var nodeid="#life";
	 previousid=nodeid;
	 previouslvl=-1;
	
	svg2.select(nodeid)
	.style("fill", "#fff");
	
	svg2.selectAll(".leafnodes")
	.style("fill","#61b329");
	svg2.selectAll(".foodpaths").remove();
	svg2.select(".triangles").remove();
//	if(allstatus==0) {
	 // remove all paths
	for(var nodnam in foodchain) { // make all rects to default color
	foodchain[nodnam].status=0;
	var nodname=nodnam.replace(/ /g,'');
	var allid="#"+nodname;
	svg2.select(allid)
	.style("fill","#61B329");
	}
//	allstatus=1;
//	}
//	else if(allstatus==1) {
	for(var node in foodchain){
	if(foodchain[node].eats.length!=0) {	
	var startxpos=foodchain[node].xpos+(foodchain[node].width/2);
	var startypos=foodchain[node].ypos;
	var startpair=startxpos+","+startypos;
	for(var j=0;j<foodchain[node].eats.length;j++){
	var endnode=foodchain[node].eats[j];
	var endxpos=foodchain[endnode].xpos+(foodchain[endnode].width/2);
	var endypos=foodchain[endnode].ypos;
	var endpair=endxpos+","+endypos;
	var xcor=(startxpos+endxpos)/2;
	var dist=Math.sqrt(Math.pow(startxpos-endxpos,2)+Math.pow(startypos-endypos,2));
	var ycor=(2*height2/3)-((height2)*(dist/width2));
	var pathid=node.replace(/ /g,'')+""+foodchain[node].eats[j].replace(/ /g,'');
	var pathstr="M "+startpair+" C"+xcor+","+ycor+" "+xcor+","+ycor+" "+endpair;
	svg2.append("path")
	.attr("id",pathid)
	.attr("class","foodpaths")
//	.transition()
//    .duration(2000)
//   .ease("linear")
	.attr("d", pathstr)
	.attr("fill","none")
	.attr("stroke","#B22222")
	.attr("stroke-width",1);
	
	
	var pathidanim="#"+pathid;
	var totalLength = d3.select(pathidanim).node().getTotalLength();
	d3.select(pathidanim)
      .attr("stroke-dasharray", totalLength + " " + totalLength)
      .attr("stroke-dashoffset", totalLength)
      .transition()
        .duration(1000)
        .ease("linear")
        .attr("stroke-dashoffset", 0);
	
	
	}
	foodchain[node].status=1;
	}
	}
	allstatus=0;
//	}
	})
	.on("dblclick", function() {
	svg2.select("#life")
	.style("fill", color2[0]);
	svg2.selectAll(".foodpaths").remove();
	svg2.selectAll(".triangles").remove();
	});
	
	
 function createrect(widthc,levelc,positionc,ifchildc,nodenamec) {
 var nodeid=nodenamec.replace(/ /g,'');
 svg2.append("rect")
	.attr("class","stacks")
	.attr("class", function() {
	if(ifchildc==false)
	return "leafnodes";
	else if(ifchildc==true)
	return "parentnodes";
	})
	.attr("id",nodeid)
	.attr("width",widthc)
	.attr("height",stackheight)
	.attr("x",positionc)
	.attr("y",stackheight*(levelc+1))
	.style("fill",function() {
	if(ifchildc==true)
	return color2[levelc+1];
	else
	return "#61B329";
	})
	.attr("stroke-width",1)
	.attr("stroke","#777")
	.on("click", function() {
	if(ifchildc==false) {
	if(foodchain[nodenamec].status==0) {
	if(foodchain[nodenamec].eats.length!=0) {
	var startxpos=foodchain[nodenamec].xpos+(foodchain[nodenamec].width/2);
	var startypos=foodchain[nodenamec].ypos;
	var startpair=startxpos+","+startypos;
	for(var i=0;i<foodchain[nodenamec].eats.length;i++) {
	var endnode=foodchain[nodenamec].eats[i];
	var endxpos=foodchain[endnode].xpos+(foodchain[endnode].width/2);
	var endypos=foodchain[endnode].ypos;
	var endpair=endxpos+","+endypos;
	var xcor=(startxpos+endxpos)/2;
	var dist=Math.sqrt(Math.pow(startxpos-endxpos,2)+Math.pow(startypos-endypos,2));
	var ycor=(2*height2/3)-((height2)*(dist/width2));
	var pathid=nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	var pathstr="M "+startpair+" C"+xcor+","+ycor+" "+xcor+","+ycor+" "+endpair;
	svg2.append("path")
	.attr("id",pathid)
	.attr("class","foodpaths")
	.attr("d", pathstr)
//	.transition()
//    .duration(2000)
//    .ease("linear")
	.attr("fill","none")
	.attr("stroke","#B22222")
	.attr("stroke-width",1);
	
	var pathidanim="#"+pathid;
	var totalLength = d3.select(pathidanim).node().getTotalLength();
	d3.select(pathidanim)
      .attr("stroke-dasharray", totalLength + " " + totalLength)
      .attr("stroke-dashoffset", totalLength)
      .transition()
        .duration(1000)
        .ease("linear")
        .attr("stroke-dashoffset", 0);
	
	
	}
	foodchain[nodenamec].status=1;
	}
	}
	else if(foodchain[nodenamec].status==1){ // animate highlighted paths in this block and remove in another block, //on dblclick of rect add locations
	var sourceid="#"+nodenamec.replace(/ /g,'');
	for(var i=0;i<foodchain[nodenamec].eats.length;i++) {
	var pathid="#"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	var targetid="#"+foodchain[nodenamec].eats[i].replace(/ /g,'');
	
	svg2.select(pathid)
	.attr("stroke","#0f0");
	
	svg2.select(targetid)
	.style("fill","red");

	//animate here

 	
	svg2.append("path")
	.attr("class","triangles")
	.attr("id",function() {
	return "anims"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	})
	.attr("d","M-5,-2.5 L5,-2.5 L 0,-17.5 z")
	.attr("stroke","red")
	.attr("stroke-width","1.06")
	.style("fill","yellow");
	var animsid="#anims"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	svg2.select(animsid)
	.append("animateMotion")
	.attr("id",function(){
	return "animationin"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	})
	.attr("dur","6s")
	.attr("repeatCount","indefinite")
	.attr("rotate","auto");
	
	var animationinid="#animationin"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	
	svg2.select(animationinid)
	.append("mpath")
	.attr("id", function() {
	return "tri"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	})
	.attr("xlink:href",pathid);
	
	//animation ends here
	
	}
	svg2.select(sourceid)
	.style("fill","yellow");
	foodchain[nodenamec].status=2;
	
	
	//call map paths here ---------------------------------------------------------------------------------<
	
	
	
	console.log(foodchain[nodenamec]);
	
	
	
	//end map pth calls here ------------------------------------------------------------------------------<
	}
	else if(foodchain[nodenamec].status==2){ // remove animations here in this block, 
	
	var sourceid="#"+nodenamec.replace(/ /g,'');
	for(var i=0;i<foodchain[nodenamec].eats.length;i++) {
	var pathid="#"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	var targetid="#"+foodchain[nodenamec].eats[i].replace(/ /g,'');
	svg2.select(pathid)
	.attr("stroke","#B22222")
	.attr("stroke-width",1);
	svg2.select(targetid)
	.style("fill","#61B329");
	var animsid="#anims"+nodenamec.replace(/ /g,'')+""+foodchain[nodenamec].eats[i].replace(/ /g,'');
	svg2.select(animsid).remove();
	}
	
	svg2.select(sourceid)
	.style("fill","#61B329");
	
	
	
	foodchain[nodenamec].status=1;
	
	}
	}
	else if(ifchildc==true) {
	if(previousid!=null) {
	svg2.select(previousid)
	.style("fill", function() {
	return color2[previouslvl+1];
	});
	}
	var nodeid="#"+nodenamec.replace(/ /g,'');
	 previousid=nodeid;
	 previouslvl=levelc;
	
	svg2.select(nodeid)
	.style("fill", "#fff");
	svg2.selectAll(".foodpaths").remove();
	svg2.selectAll(".triangles").remove();
	svg2.selectAll(".leafnodes")
	.style("fill","#61b329");
	for(var a=0;a<childarr[nodenamec].length;a++) {		
	var node=childarr[nodenamec][a];	
	var startxpos=foodchain[node].xpos+(foodchain[node].width/2);
	var startypos=foodchain[node].ypos;
	var startpair=startxpos+","+startypos;
	
	if(foodchain[node].eats.length!=0) {
	for(var j=0;j<foodchain[node].eats.length;j++){
	var endnode=foodchain[node].eats[j];
	var endxpos=foodchain[endnode].xpos+(foodchain[endnode].width/2);
	var endypos=foodchain[endnode].ypos;
	var endpair=endxpos+","+endypos;
	var xcor=(startxpos+endxpos)/2;
	var dist=Math.sqrt(Math.pow(startxpos-endxpos,2)+Math.pow(startypos-endypos,2));
	var ycor=(2*height2/3)-((height2)*(dist/width2));
	var pathid=node.replace(/ /g,'')+""+foodchain[node].eats[j].replace(/ /g,'');
	var pathstr="M "+startpair+" C"+xcor+","+ycor+" "+xcor+","+ycor+" "+endpair;
	svg2.append("path")
	.attr("id",pathid)
	.attr("class","foodpaths")
//	.transition()
//    .duration(2000)
//    .ease("linear")
	.attr("d", pathstr)
	.attr("fill","none")
	.attr("stroke","#B22222")
	.attr("stroke-width",1);
	
	
	var pathidanim="#"+pathid;
	var totalLength = d3.select(pathidanim).node().getTotalLength();
	d3.select(pathidanim)
      .attr("stroke-dasharray", totalLength + " " + totalLength)
      .attr("stroke-dashoffset", totalLength)
      .transition()
        .duration(1000)
        .ease("linear")
        .attr("stroke-dashoffset", 0);
	
	
	}
	foodchain[node].status=1;
	}
	}
	
	}
	
	
	
	svg3.selectAll(".maplocs").remove();
	svg3.selectAll(".mappaths").remove();
	svg3.selectAll(".mapimages").remove();
	
	//map animations goes here _____________________________________________________________________________________________<
	
	if(foodchain[nodenamec].migrating==false) {
	if(foodchain[nodenamec].locations.length!=0){
	for(var b=0;b<foodchain[nodenamec].locations.length;b++){
	var locationid=(foodchain[nodenamec].locations[b].replace(/ /g,''))+""+(nodenamec.replace(/ /g,''));
	svg3.append("circle")
	.attr("class","maplocs")
	.attr("id",locationid)
	.attr("r", 3)
    .attr("fill", "green") 
    .attr("stroke","black")
	.attr("transform", function() {
    return "translate(" + projection([foodchain[nodenamec].longitude[b], foodchain[nodenamec].latitude[b]]) + ")";
     });
	
	// access data as foodchain[nodenamec].locations[b], foodchain[nodenamec].latitude[b], foodchain[nodenamec].longiude[b]
	//use longitude, latitude data to convert into x,y coordinates to create path on globe
	
	}
	}
	}
	
	else if(foodchain[nodenamec].migrating==true) {
	for(var c=0;c<foodchain[nodenamec].locations.length;c++) {
	var locationid=(foodchain[nodenamec].locations[c].replace(/ /g,''))+""+(nodenamec.replace(/ /g,''));
	svg3.append("circle")
	.attr("class","maplocs")
	.attr("id",locationid)
	.attr("r", 3)
    .attr("fill", "green") 
    .attr("stroke","black")
	.attr("transform", function() {
    return "translate(" + projection([foodchain[nodenamec].longitude[c], foodchain[nodenamec].latitude[c]]) + ")";
     });
	
	}
	svg3.append("path")
	.attr("class","mappaths")
	.attr("id","olala")
	 .attr("d", function() {
	 var firstlat=foodchain[nodenamec].latitude[0]+7;
	 var firstlong=foodchain[nodenamec].longitude[0]-15;
	 var firstpoint=projection([firstlong,firstlat]);
	 var totalpath="M"+firstpoint;
	 for(var d=1;d<foodchain[nodenamec].locations.length;d++) {
	 totalpath=totalpath+" L"+projection([foodchain[nodenamec].longitude[d]-15,foodchain[nodenamec].latitude[d]+7]);
	 }
	 return totalpath;
	 })
	 .style("fill","none")
	 .attr("stroke","red")
	 .attr("stroke-width","1")
	 .attr("opacity",0);
	
	
	//migration animation goes here -----------------------------------------------------------------------------------------<
	
	
	svg3.append("image")
	.attr("xlink:href","Imgtypes/bird.png")
	.attr("width",50)
	.attr("height",50)
	.attr("class","mapimages")
	.attr("id",function() {
	return "anims";
	});
	var animsid="#anims";
	svg3.select(animsid)
	.append("animateMotion")
	.attr("id",function(){
	return "animationin";
	})
	.attr("dur","10s")
	.attr("repeatCount","indefinite");
	
	var animationinid="#animationin";
	
	svg3.select(animationinid)
	.append("mpath")
	.attr("id", function() {
	return "tri";
	})
	.attr("xlink:href","#olala");
	
	}
	
	// stack Description here ---------------------------------------------------------------------------------------------<
	
	
	d3.selectAll(".consspan").remove();
	d3.selectAll(".prodspan").remove();
	d3.selectAll(".titledesc").remove();
	d3.selectAll(".imgdesc").remove();
	d3.selectAll(".otherdesc").remove();
	
	d3.select(".stackdesc").append("div")
	.attr("class","titledesc");
	
	d3.select(".titledesc")
	.append("span")
	.attr("class","consspan")
	.append("text")
	.text(nodenamec);
	if(foodchain[nodenamec].eats) {
	for(var e=0;e<foodchain[nodenamec].eats.length;e++) {
	
	d3.select(".titledesc")
	.append("span")
	.attr("class","prodspan")
	.append("text")
	.text(foodchain[nodenamec].eats[e]);
	
	}
	}
	var imgpath="Images/"+nodenamec+".jpg";
	d3.select(".stackdesc")
	.append("div")
	.attr("class","imgdesc")
	.append("img")
	.attr("src",imgpath);
	
	d3.select(".stackdesc")
	.append("div")
	.attr("class","otherdesc");
	
	d3.select(".otherdesc")
	.append("div")
	.attr("class","descdesc")
	.append("text")
	.text(foodchain[nodenamec].description);
	
	d3.select(".otherdesc")
	.append("div")
	.attr("class","linkdesc");
		
	d3.select(".linkdesc")
	.html("<a href='https://en.wikipedia.org/wiki/"+nodenamec+"' class='anchor' target='_blank'>More Info</a>")

	})
	.on("dblclick", function() {
	/*alert("doubleclick");*/
	})
	.on("mouseover", function() {
	var imgsrc="Images/"+nodenamec+".jpg";
	div2.transition()    
            .duration(200)    
            .style("opacity", 1.0);    
      div2.html(nodenamec+"<br>")
            .style("left", (d3.event.pageX) + "px")   
            .style("top", (d3.event.pageY - 28) + "px");
			if(ifchildc==false) {
			div2.append("img")
			.attr("class","picture")
			.attr("src",imgsrc)
			.attr("width",120)
			.attr("height",150);
		
			d3.select(".tooltip2")
			.style("width","122px")
			.style("height","168px");
		}
	})
	.on("mouseout", function() {
	div2.transition()    
                .duration(500)    
               .style("opacity", 0);
	d3.select(".tooltip2")
			.style("width","100px")
			.style("height","20px");
	});
	
 }
 
 var lvltotal=[0,0,0,0,0];
  d3.json("data.json", function(json) {
  
  
  var leafwidth=width2/json.leafs;
  console.log(json);
  var lvl=[0,0,0,0,0];
for(var j=0;j<json.children.length;j++){
lvl[0]=lvl[0]+1;
lvltotal[0]=lvltotal[0]+json.children[j].leafs;
for(var k=0;k<json.children[j].children.length;k++){
lvl[1]=lvl[1]+1;
lvltotal[1]=lvltotal[1]+json.children[j].children[k].leafs;
for(var l=0;l<json.children[j].children[k].children.length;l++){
lvl[2]=lvl[2]+1;
lvltotal[2]=lvltotal[2]+json.children[j].children[k].children[l].leafs;
for(var m=0;m<json.children[j].children[k].children[l].children.length;m++){
lvl[3]=lvl[3]+1;
lvltotal[3]=lvltotal[3]+json.children[j].children[k].children[l].children[m].leafs;
if(json.children[j].children[k].children[l].children[m].children){
for(var n=0;n<json.children[j].children[k].children[l].children[m].children.length;n++){
lvl[4]=lvl[4]+1;
lvltotal[4]=lvltotal[4]+json.children[j].children[k].children[l].children[m].children[n].leafs;
}
}
}
}
}
}

  console.log(lvl[0]+"-"+lvl[1]+"-"+lvl[2]+"-"+lvl[3]+"-"+lvl[4]);
  
  if(json.children) {
  json.xpos=0;
  json.ypos=0;
  json.width=width2;
  var lvl0position=0;
  for(var j=0;j<lvl[0];j++){
  childarr[json.children[j].name]=new Array();
  var lvl0width=Number(json.children[j].leafs/lvltotal[j]*width2);
  var lvl0level=0;
  json.children[j].ypos=stackheight*(lvl0level+1);
  if(j!=0)
  var lvl0position=Number(lvl0position+((Number(json.children[j-1].leafs)/lvltotal[j-1])*width2));
  var ifchild=json.children[j].children ? true : false;
  json.children[j].xpos=lvl0position;
  json.children[j].width=lvl0width;
  var nodename=json.children[j].name;
  createrect(lvl0width,lvl0level,lvl0position,ifchild,nodename);
  
	if(json.children[j].children) {
	var sum=0;
    for(var k=0;k<json.children[j].children.length;k++) {
	sum=sum+Number(json.children[j].children[k].leafs);
	}
	
	var lvl1position=Number(json.children[j].xpos);
	for(var k=0;k<json.children[j].children.length;k++){
	childarr[json.children[j].children[k].name]=new Array();
	var lvl1width=Number((Number(json.children[j].children[k].leafs)/sum)*Number(json.children[j].width));
	json.children[j].children[k].width=lvl1width;
	var lvl1level=1;
	json.children[j].children[k].ypos=stackheight*(lvl1level+1);
	if(k!=0)
	var lvl1position=Number((Number(json.children[j].children[k-1].width)+Number(json.children[j].children[k-1].xpos)));
	json.children[j].children[k].xpos=lvl1position;
	var ifchild=json.children[j].children[k].children ? true : false;
	var nodename=json.children[j].children[k].name;
	createrect(lvl1width,lvl1level,lvl1position,ifchild,nodename);
	
	if(json.children[j].children[k].children) {
	var sum1=0;
    for(var l=0;l<json.children[j].children[k].children.length;l++) {
	sum1=sum1+Number(json.children[j].children[k].children[l].leafs);
	}
	
	var lvl2position=Number(json.children[j].children[k].xpos);
	for(var l=0;l<json.children[j].children[k].children.length;l++){
	childarr[json.children[j].children[k].children[l].name]=new Array();
	var lvl2width=Number((Number(json.children[j].children[k].children[l].leafs)/sum1)*Number(json.children[j].children[k].width));
	json.children[j].children[k].children[l].width=lvl2width;
	var lvl2level=2;
	json.children[j].children[k].children[l].ypos=stackheight*(lvl2level+1);
	if(l!=0)
	var lvl2position=Number(Number(json.children[j].children[k].children[l-1].width)+Number(json.children[j].children[k].children[l-1].xpos));
	json.children[j].children[k].children[l].xpos=lvl2position;
	var ifchild=json.children[j].children[k].children[l].children ? true : false;
	var nodename=json.children[j].children[k].children[l].name;
	createrect(lvl2width,lvl2level,lvl2position,ifchild,nodename);
	
	if(json.children[j].children[k].children[l].children) {
	var sum2=0;
    for(var m=0;m<json.children[j].children[k].children[l].children.length;m++) {
	sum2=sum2+Number(json.children[j].children[k].children[l].children[m].leafs);
	}
	
	var lvl3position=Number(json.children[j].children[k].children[l].xpos);
	for(var m=0;m<json.children[j].children[k].children[l].children.length;m++){
	if(json.children[j].children[k].children[l].children[m].children) {
	childarr[json.children[j].children[k].children[l].children[m].name]=new Array();
	}
	if(json.children[j].children[k].children[l].children[m].leafs)
	var lvl3width=Number(Number(json.children[j].children[k].children[l].children[m].leafs)/sum2*Number(json.children[j].children[k].children[l].width));
	else
	var lvl3width=leafwidth;
	json.children[j].children[k].children[l].children[m].width=lvl3width;
	var lvl3level=3;
	var lvl3ypos=stackheight*(lvl3level+1);
	json.children[j].children[k].children[l].children[m].ypos=stackheight*(lvl3level+1);
	if(m!=0)
	var lvl3position=Number(Number(json.children[j].children[k].children[l].children[m-1].width)+Number(json.children[j].children[k].children[l].children[m-1].xpos));
	json.children[j].children[k].children[l].children[m].xpos=lvl3position;
	var ifchild=json.children[j].children[k].children[l].children[m].children ? true : false;
	var nodename=json.children[j].children[k].children[l].children[m].name;
	
	if(!(json.children[j].children[k].children[l].children[m].children)) {
	if(json.children[j].children[k].children[l].children[m].eats)
	var eatsarr=json.children[j].children[k].children[l].children[m].eats;
	else
	var eatsarr=[];
	}
	createrect(lvl3width,lvl3level,lvl3position,ifchild,nodename);
	
	
	if(!(json.children[j].children[k].children[l].children[m].children)) {
	//push json.children[j].children[k].children[l].children[m].name
	
	childarr[json.children[j].name].push(json.children[j].children[k].children[l].children[m].name);
	childarr[json.children[j].children[k].name].push(json.children[j].children[k].children[l].children[m].name);
	childarr[json.children[j].children[k].children[l].name].push(json.children[j].children[k].children[l].children[m].name);
	var locations=[];
	var latitude=[];
	var longitude=[];
	if(json.children[j].children[k].children[l].children[m].locations) {
	for(var a=0;a<json.children[j].children[k].children[l].children[m].locations.length;a++) {
	locations[a]=json.children[j].children[k].children[l].children[m].locations[a];
	latitude[a]=json.children[j].children[k].children[l].children[m].latitude[a];
	longitude[a]=json.children[j].children[k].children[l].children[m].longitude[a];
	}
	}
	var migrating=false;
	if(json.children[j].children[k].children[l].children[m].migrating) {
	if(json.children[j].children[k].children[l].children[m].migrating==true)
	migrating=true;
	}
	
	var description="olala";
	if(json.children[j].children[k].children[l].children[m].description) {
	var description=json.children[j].children[k].children[l].children[m].description;
	}
	
	foodchain[nodename]={
	"description":description,
	"migrating":migrating,
	"locations":locations,
	"latitude":latitude,
	"longitude":longitude,
	"xpos":lvl3position,
	"ypos":lvl3ypos,
	"level":lvl3level,
	"width":lvl3width,
	"eats":eatsarr,
	"status":0,
	"parentpos":[
	{"xpos":json.children[j].children[k].children[l].xpos, "ypos":json.children[j].children[k].children[l].ypos},
	{"xpos":json.children[j].children[k].xpos,"ypos":json.children[j].children[k].ypos},
	{"xpos":json.children[j].xpos,"ypos":json.children[j].ypos}
	]
	};
	}
	
	
    if(json.children[j].children[k].children[l].children[m].children){
	var lvl4position=Number(json.children[j].children[k].children[l].children[m].xpos);
	for(var p=0;p<json.children[j].children[k].children[l].children[m].children.length;p++) {
	var lvl4width=leafwidth;
	json.children[j].children[k].children[l].children[m].children[p].width=lvl4width;
	var lvl4level=4;
	var lvl4ypos=stackheight*(lvl4level+1);
	json.children[j].children[k].children[l].children[m].children[p].ypos=stackheight*(lvl4level+1);
	if(p!=0)
	var lvl4position=Number(Number(json.children[j].children[k].children[l].children[m].children[p-1].xpos)+Number(json.children[j].children[k].children[l].children[m].children[p-1].width));
	json.children[j].children[k].children[l].children[m].children[p].xpos=lvl4position;
	var ifchild=json.children[j].children[k].children[l].children[m].children[p].children ? true : false;
	var nodename=json.children[j].children[k].children[l].children[m].children[p].name;
	
	if(json.children[j].children[k].children[l].children[m].children[p].eats) {
	var eatsarr=json.children[j].children[k].children[l].children[m].children[p].eats;
	}
	else {
	var eatsarr=[];
	}
	createrect(lvl4width,lvl4level,lvl4position,ifchild,nodename);
	
	childarr[json.children[j].name].push(json.children[j].children[k].children[l].children[m].children[p].name);
	childarr[json.children[j].children[k].name].push(json.children[j].children[k].children[l].children[m].children[p].name);
	childarr[json.children[j].children[k].children[l].name].push(json.children[j].children[k].children[l].children[m].children[p].name);
	childarr[json.children[j].children[k].children[l].children[m].name].push(json.children[j].children[k].children[l].children[m].children[p].name);
	
	
	
	var locations=[];
	var latitude=[];
	var longitude=[];
	if(json.children[j].children[k].children[l].children[m].children[p].locations) {
	for(var a=0;a<json.children[j].children[k].children[l].children[m].children[p].locations.length;a++) {
	locations[a]=json.children[j].children[k].children[l].children[m].children[p].locations[a];
	latitude[a]=json.children[j].children[k].children[l].children[m].children[p].latitude[a];
	longitude[a]=json.children[j].children[k].children[l].children[m].children[p].longitude[a];
	}
	}
	
	var migrating=false;
	if(json.children[j].children[k].children[l].children[m].children[p].migrating) {
	if(json.children[j].children[k].children[l].children[m].children[p].migrating==true)
	migrating=true;
	}
	
	var description="olala";
	if(json.children[j].children[k].children[l].children[m].children[p].description) {
	var description=json.children[j].children[k].children[l].children[m].children[p].description;
	}
	
	foodchain[nodename]={
	"description":description,
	"migrating":migrating,
	"locations":locations,
	"latitude":latitude,
	"longitude":longitude,
	"xpos":lvl4position,
	"ypos":lvl4ypos,
	"level":lvl4level,
	"width":lvl4width,
	"eats":eatsarr,
	"status":0,
	"parentpos":[
	{"xpos":json.children[j].children[k].children[l].children[m].xpos, "ypos":json.children[j].children[k].children[l].children[m].ypos},
	{"xpos":json.children[j].children[k].children[l].xpos, "ypos":json.children[j].children[k].children[l].ypos},
	{"xpos":json.children[j].children[k].xpos,"ypos":json.children[j].children[k].ypos},
	{"xpos":json.children[j].xpos,"ypos":json.children[j].ypos}
	]
	};
	}
	}
	
	
	}
	}
	}
	}
	}
	}
  }
  }
  console.log(foodchain);
});


  </script>
  <div class="stackdesc"></div>
  <div class="mapdesc"></div>
  </body>
</html>
